<script>
/* FORCE LOGIN ON LOAD */
localStorage.removeItem("logged"); // تنسى تسجيل الدخول دائماً
auth.style.display="flex"; 
home.style.display="none";

/* RENDER LEVELS */
function renderLevels(){
  levelContainer.innerHTML="";
  levels.forEach(l=>{
    const div=document.createElement("div");
    div.className="level";
    div.innerText=l.name;

    if(l.shubs){
      const dropdown=document.createElement("div");
      dropdown.className="sublvl-dropdown";
      dropdown.style.display="none";
      dropdown.style.position="absolute";
      dropdown.style.right="0"; // تبان فوق أو تحت المستوى
      dropdown.style.top="105%"; // تظهر أسفل المستوى
      dropdown.style.background="#222";
      dropdown.style.border="1px solid #1e90ff";
      dropdown.style.borderRadius="8px";
      dropdown.style.minWidth="120px"; // صغيرة
      dropdown.style.flexDirection="column";
      dropdown.style.fontSize="13px"; // أصغر
      dropdown.style.zIndex="1000";

      l.shubs.forEach(s=>{
        const sub=document.createElement("div");
        sub.innerText=s;
        sub.style.padding="6px 10px";
        sub.style.color="#ccc";
        sub.style.cursor="pointer";
        sub.onclick=(e)=>{
          e.stopPropagation();
          requireLogin(()=>openLevel(`${l.name} ${s}`));
          dropdown.style.display="none";
        };
        sub.onmouseover=()=>sub.style.background="#1e90ff"; 
        sub.onmouseout=()=>sub.style.background=""; 
        dropdown.appendChild(sub);
      });

      div.appendChild(dropdown);
      div.style.position="relative"; // لتحديد موقع القائمة
      div.onclick=()=>{
        requireLogin(()=>{
          dropdown.style.display = dropdown.style.display==="flex"?"none":"flex";
        });
      };
    } else div.onclick=()=>requireLogin(()=>openLevel(l.name));

    levelContainer.appendChild(div);
  });
}

/* AUTH */
function signup(){
  const emailVal=emailInput.value.trim();
  const passVal=passInput.value.trim();
  if(!emailVal||!passVal){status.innerText="❌ Fill all fields";return;}
  auth.style.display="none";
  renderLevels();
  home.style.display="block";
}

function login(){
  const emailVal=emailInput.value.trim();
  const passVal=passInput.value.trim();
  auth.style.display="none";
  renderLevels();
  home.style.display="block";
}

function start(){
  auth.style.display="none";
  renderLevels();
  home.style.display="block";
}

function requireLogin(callback){
  callback(); // لأننا دائماً نريد عرض تسجيل الدخول أول مرة
}
</script>
