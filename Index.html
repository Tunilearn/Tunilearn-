<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TuniLearn</title>

<style>
*{box-sizing:border-box}
body{margin:0;font-family:Arial;background:#111;color:#1e90ff}
#auth{min-height:100vh;display:flex;justify-content:center;align-items:center}
.phone{width:360px;background:#1a1a1a;padding:25px;border-radius:22px}
h1{text-align:center;color:white}
.dot{color:red}
p{text-align:center;color:#aaa;font-size:14px}
input{width:100%;padding:12px;margin:6px 0;border-radius:12px;border:none}
#showPass{width:100%;background:#333;color:white;border:none;font-size:10px;padding:4px;border-radius:999px;margin-bottom:10px;cursor:pointer}
.buttons{display:flex;justify-content:space-between}
button{width:48%;padding:12px;border:none;border-radius:14px;background:#e53935;color:white;font-weight:bold;cursor:pointer}
#forgot{width:70%;margin:8px auto;display:block;font-size:12px;background:#2196f3;padding:6px;border-radius:8px}
#status{color:#ff5252;text-align:center;margin-top:8px;font-weight:bold}
#home{display:none;padding:20px}
.banner{background:#87cefa;color:black;padding:12px;border-radius:12px;text-align:center;font-weight:bold}
.level{margin-top:10px;border:1px solid #1e90ff;padding:12px;border-radius:10px;background:#222;color:#ccc;cursor:pointer;position:relative}
.sublvl{display:none;position:absolute;top:100%;right:0;background:#222;border:1px solid #1e90ff;border-radius:8px;width:160px;z-index:10}
.sublvl div{padding:6px 10px;color:white;cursor:pointer}
#levelPage{display:none;padding:20px}
.file{border:1px solid #1e90ff;padding:8px;border-radius:8px;margin-top:6px;display:flex;align-items:center;gap:10px;color:white;cursor:pointer}
.file img{width:50px;height:50px;border-radius:8px}
.back{margin-top:15px;border:2px solid green;background:none;color:white;padding:8px;border-radius:10px;cursor:pointer}
</style>
</head>

<body>

<div id="auth">
  <div class="phone">
    <h1>Tuni<span class="dot">•</span>Learn</h1>
    <p>منصة تونسية للفروض والاختبارات</p>

    <input id="email" placeholder="Email">
    <input id="phone" placeholder="Phone number">
    <input id="password" type="password" placeholder="Password">

    <button id="showPass" onclick="togglePassword()">Password visibility</button>

    <div class="buttons">
      <button onclick="signup()">Sign up</button>
      <button onclick="login()">Log in</button>
    </div>

    <button id="forgot" onclick="forgotPassword()">Forgot password</button>
    <div id="status"></div>
  </div>
</div>

<div id="home">
  <div class="banner">All exams that you need</div>
  <div id="levels"></div>
</div>

<div id="levelPage">
  <h2 id="levelTitle" style="color:white"></h2>
  <div id="filesContainer"></div>
  <button class="back" onclick="backHome()">رجوع</button>
</div>

<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCXzhUgYy1MMvnftDi1d5XFeRJTFa35eQU",
    authDomain: "tunilearn-e4b8e.firebaseapp.com",
    projectId: "tunilearn-e4b8e",
    storageBucket: "tunilearn-e4b8e.appspot.com",
    messagingSenderId: "730477107505",
    appId: "1:730477107505:web:eee97b8ef099326b8cf810",
    measurementId: "G-H17BY13PDN"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  // Disable Sign Up if user is logged in
  onAuthStateChanged(auth, user => {
    if(user){
      status.innerText="✅ أنت مسجل الدخول مسبقاً";
    }
  });

  function signup(){
    const e=email.value.trim(), p=password.value.trim();
    if(!e||!p){status.innerText="❌ أكمل كل المعطيات"; return;}
    createUserWithEmailAndPassword(auth,e,p)
      .then(() => {
        status.innerText="✅ تم التسجيل بنجاح";
        enterHome();
      })
      .catch(err => {status.innerText="❌ "+err.message;});
  }

  function login(){
    const e=email.value.trim(), p=password.value.trim();
    if(!e||!p){status.innerText="❌ أكمل كل المعطيات"; return;}
    signInWithEmailAndPassword(auth,e,p)
      .then(() => {status.innerText="✅ تم تسجيل الدخول"; enterHome();})
      .catch(err => {status.innerText="❌ "+err.message;});
  }

  function forgotPassword(){
    const e=prompt("Tunilearn – استعادة الباسورد\n\nأدخل الإيميل");
    if(!e) return;
    // Firebase لا يسمح بالوصول المباشر لكلمة السر
    alert("لأسباب أمان، يجب إعادة تعيين الباسورد عبر بريدك الإلكتروني");
  }

  function togglePassword(){ password.type=password.type==="password"?"text":"password"; }

  // Rest same as before
  function enterHome(){ authDiv.style.display="none"; home.style.display="block"; renderLevels(); }
  const levelsData=[
    {name:"7 أساسي",shubs:["عام"]},
    {name:"8 أساسي",shubs:["عام"]},
    {name:"9 أساسي",shubs:["عام"]},
    {name:"1 ثانوي",shubs:["عام"]},
    {name:"2 ثانوي",shubs:["آداب","اقتصاد","علوم"]},
    {name:"3 ثانوي",shubs:["آداب","اقتصاد","علوم إعلامية","علوم تقنية","علوم","رياضيات"]},
    {name:"4 ثانوي",shubs:["آداب","اقتصاد","علوم إعلامية","علوم تقنية","علوم","رياضيات"]}
  ];

  function renderLevels(){
    levels.innerHTML="";
    levelsData.forEach(l=>{
      const d=document.createElement("div");
      d.className="level";
      d.innerText=l.name;
      if(l.shubs.length>1 || l.shubs[0]!=="عام"){
        const subBox=document.createElement("div");
        subBox.className="sublvl";
        l.shubs.forEach(s=>{
          const sdiv=document.createElement("div");
          sdiv.innerText=s;
          sdiv.onclick=e=>{
            e.stopPropagation();
            openLevel(l.name+" - "+s);
            subBox.style.display="none";
          };
          subBox.appendChild(sdiv);
        });
        d.appendChild(subBox);
        d.onclick=()=>subBox.style.display=subBox.style.display==="block"?"none":"block";
      } else {
        d.onclick=()=>openLevel(l.name);
      }
      levels.appendChild(d);
    });
  }

  function openLevel(n){
    home.style.display="none";
    levelPage.style.display="block";
    levelTitle.innerText=n;
    const filesContainer=document.getElementById("filesContainer");
    filesContainer.innerHTML="";
    for(let i=1;i<=5;i++){
      const fm=document.createElement("div");
      fm.className="file";
      const img1=document.createElement("img");
      img1.src="https://via.placeholder.com/50?text=FM";
      fm.appendChild(img1);
      fm.append(" فروض مراقبة "+i);
      filesContainer.appendChild(fm);
      const fa=document.createElement("div");
      fa.className="file";
      const img2=document.createElement("img");
      img2.src="https://via.placeholder.com/50?text=FA";
      fa.appendChild(img2);
      fa.append(" فروض تأليفية "+i);
      filesContainer.appendChild(fa);
    }
  }

  function backHome(){ levelPage.style.display="none"; home.style.display="block"; }

</script>

</body>
</html>
